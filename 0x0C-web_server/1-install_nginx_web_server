#!/usr/bin/env bash
# This script installs nginx and configures it to serve a custom index page.

# Install nginx
apt-get update
apt-get install -y nginx

# Create custom index.html file
echo "Hello World!" > /var/www/html/index.html

# Ensure nginx is running
if ! ps aux | grep -q '[n]ginx'; then
    /usr/sbin/nginx
fi

# Check if nginx is listening on port 80
nc -z localhost 80
status=$?
if [ $status -ne 0 ]; then
    echo "Nginx is not listening on port 80"
    exit 1
fi

# Test nginx configuration using curl
response=$(curl -s localhost)
if [ "$response" != "Hello World!" ]; then
    echo "Failed: Nginx did not return expected content."
    exit 1
fi

echo "Nginx successfully installed and configured."

